\section{Efficient and Maliciously Secure MPC}

\subsection{The SPDZ protocol}

Suppose that parties hold shares $[a], [b], [c]$ where $c = a b$.
Then they can multiply $[x], [y]$ as follows:
\begin{enumerate}
\item
Open $[x-a]$;
open $[y-b]$
\item 
Compute $[z] = [c] + (x - a)[b] + (y - b)[a] + (x - a)(y - b) = [x y]$
\end{enumerate}

\begin{prcl}[SPDZ]
The SPDZ protocol has three stages: 
\begin{enumerate}
\item Initial setup (once and for all)
\item Preprocess phase (per execution)
\item Online phase
\end{enumerate}
Then they authenticate the shared value, by using a global key $\alpha$ and each party reveals $x_i, (\alpha x)$, where
$<X> = ([x], [\alpha \cdot x]$.

This is still \textit{homomorphic}! Since $<x>, <y>$, parties can locally compute 
\begin{align*}
    <x> &= ([x], [\alpha x]), \\
    <Y> &= ([y], [\alpha y]), \\
    &\implies ([x + y], [\alpha x + \alpha y]) = ([x + y], [\alpha(x + y)])
\end{align*}
Parties initially hold $[\alpha]$, $<a>, <b>, <c>$ such that $c = a b$.
Then given $<x>, <y>, <a>, <b>, <c>$, the parties can compute $<x y>$just like before:
\begin{enumerate}
\item Open $<x - a>$; open $<y - b>$
\item locally compute
\begin{align*}
    [z] &= [c] + (x - a)[b] + (y - b)[a] + (x - a)(y - b) \\
    [\alpha z] &= [\alpha c] + (x - a)[\alpha b] + (y - b)[\alpha a] + (x - a)(y - b)
\end{align*}
\end{enumerate}
Now that we have the general strategy, the following is the total protocol:
\begin{itemize}
\item 
Assume for each input, parties hold $<r>$.
Open $<r>$ to $P_1$, then $P_1$ sends $x - r$,
all parties adjust their shares $\implies <x>$.
\item 
Run semi-honest protocol on authenticated shares on inputs
\item 
Let $x_1, \dots, x_n$ be all opened values,
let $<y>$ be the output generated by some random $r$, and 
set $x := \sum x_i r^i$.
\item 
$P_j$ commits to $\sum (\alpha x_i)_j r^i = \gamma_j$, 
and commits to $y_j, (\alpha y)_j$.
\item 
open $\alpha$ (see below).
\item 
parties reveal $\gamma_j$; 
check that $\alpha \cdot x = \sum \gamma_j$.
\item 
parties reveal $y_j, (\alpha y)_j$;
check that $\alpha \cdot \sum y_j = \sum (\alpha y)_j$
\end{itemize}
\end{prcl}

\begin{defn}[SHE]
A \textbf{somewhat homomorphic encryption (SHE) scheme} has a public key $pk$ with threshold decryption:
\begin{align*}
    \Enc_{pk}(x), \Enc_{pk}(y) &\implies \Enc_{pk}(x + y) \\
    \Enc_{pk}(x), \Enc_{pk}(y) &\implies \Enc'_{pk}(x y) \\
    \Enc'_{pk}(x), \Enc'_{pk}(y) &\implies \Enc_{pk}(x + y) \\
\end{align*}
\end{defn}

\begin{lem}
The SPDZ protocol is secure against malicious adversaries.
\end{lem}
\begin{proof}
TODO: lecture 16
\end{proof}

TODO: how to use SHE for SPDZ protocol??? lecture 16

\putfigure{}{she-spdz1}
\putfigure{}{she-spdz2}